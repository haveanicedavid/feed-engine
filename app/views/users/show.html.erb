<div class="row user-header">
  <div class="col s3">
    <div class="card teal lighten-3">
      <div class="card-content white-text">
        <h4 class="teal-text text-darken-4"><%= current_user.name %></h4>
        <p>@<%= current_user.nickname %></p>
        <p><%= current_user.location %></p>
      </div>
    </div>
  </div>
  
  <div class="col s4 offset-s2">
      <table class="centered hoverable responsive-table teal lighten-3">
        <thead>
          <h6> Saved Searches</h6>
          <tr>
            <th data-field="name">Word</th>
            <th data-field="boolean">Active?</th>
            <th></th>
          </tr>
        <thead>
          <tbody>
            <% @saved_searches.each do |ss| %>
            <tr>
              <td><%= ss.word %></td>
              <td><%= ss.active? %></td>
            <td><%= link_to "Deactivate", search_path(ss), method: "patch" %>
            </tr>
          </tbody>
          <% end %>
        </table>
  </div>
</div>
<div class="row">
</div>

<div class="row search-div">
  <div class="col s6 offset-s3">
    <%= form_tag searches_path, method: "post" do %>
    <i class="mdi-action-search prefix"></i>
      <%= label_tag "Save Search" %>
      <%= text_field_tag "search[word]" %>
      <%= hidden_field_tag :user_id, current_user.id %>
      <%= submit_tag "Save Search", class: "btn" %>
    <% end %>
  </div>
</div>


<!-- testing -->
<div class="row search-div">
  <div class="col s6 offset-s3">
    <i class="mdi-action-search prefix search"></i>
    <label for="searchword">Quick Search</label>
    <input id="search" class="searchword" type="search" required>
    <input type="submit" value="Submit "class="btn searchTweet">
  </div>
</div>
<a href= "/email"><input type="button" value="Email "class="btn"></a>


<!-- display -->
<div class="row" id="tweets">
</div>
<!-- end testing -->

<% @analyses.each do |a| %>
<div class="row">
  <div class="col s3">
    <h4><%= a.keyword %></h4>
    <div class="col s4">
      <h6><%= a.created_at.to_date %></h6>
    </div>
  </div>
<div class="row">
  <table class="centered hoverable responsive-table analyses-table teal lighten-4">
    <thead>
      <tr>
        <th data-field="number">Number</th>
        <th data-field="name">Sentiment</th>
        <th data-field="number">Polarity</th>
      </tr>
    <thead>
    <tbody>
      <% a.analysis.each do |k, v| %>
      <tr>
        <td><%= v.split(",").first.to_s.delete!("[") %></td>
        <td><%= k %></td>
        <td><%= v.split(",").last.to_s.delete!("]").to_f.round(3) %></td>
      </tr>
    </tbody>
    <% end %>
  </table>
  <% end %>
</div>

<div class="positive">
  <% positive = [] %>
  <% @saved_searches.each do |ss| %>
    <% Analysis.where(keyword: ss.word).each do |a| %>
      <% a.analysis.each do |k, v| %>
        <% if k == "positive" %>
          <% positive << (v.split(",").first.to_s.delete!("[")) %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <%= positive %>
</div>

<div class="negative">
  <% positive = [] %>
  <% @saved_searches.each do |ss| %>
    <% Analysis.where(keyword: ss.word).each do |a| %>
      <% a.analysis.each do |k, v| %>
        <% if k == "negative" %>
          <% positive << (v.split(",").first.to_s.delete!("[")) %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <%= positive %>
</div>

<div class="neutral">
  <% positive = [] %>
  <% @saved_searches.each do |ss| %>
    <% Analysis.where(keyword: ss.word).each do |a| %>
      <% a.analysis.each do |k, v| %>
        <% if k == "neutral" %>
          <% positive << (v.split(",").first.to_s.delete!("[")) %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  <%= positive %>
</div>

<svg id="visualisation" width="1000" height="500"></svg>

